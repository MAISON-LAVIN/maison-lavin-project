<template>
    <lightning-card title="주문 확인" icon-name="standard:orders">
        
        <div class="slds-p-around_medium">
            
            <div class="slds-grid slds-wrap slds-gutters">
                
                <!-- 왼쪽: 최종 미리보기 -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-2">
                    <div class="preview-section">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">최종 미리보기</h3>
                        
                        <div class="preview-container">
                            <!-- 제품 이미지 -->
                            <template if:true={productImageUrl}>
                                <img 
                                    src={productImageUrl} 
                                    alt="제품 이미지"
                                    class="product-image"/>
                                
                                <!-- 이니셜 오버레이 -->
                                <template if:true={showInitials}>
                                    <div class="initials-overlay" style={initialsStyleString}>
                                        {initials}
                                    </div>
                                </template>
                            </template>
                            
                            <!-- 이미지 로딩 중 -->
                            <template if:false={productImageUrl}>
                                <div class="image-placeholder">
                                    <lightning-spinner alternative-text="로딩 중" size="small"></lightning-spinner>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                
                <!-- 오른쪽: 선택 내용 + 매장 선택 -->
                <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-2 slds-large-size_1-of-2">
                    
                    <!-- 선택 내용 확인 섹션 -->
                    <div class="review-section slds-m-bottom_large">
                        <h3 class="slds-text-heading_small slds-m-bottom_medium">선택하신 내용</h3>
                        
                        <!-- 카테고리 -->
                        <div class="review-item slds-m-bottom_small">
                            <span class="review-label">카테고리</span>
                            <span class="review-value">{selectedFamily}</span>
                        </div>
                        
                        <!-- 제품명 -->
                        <div class="review-item slds-m-bottom_small">
                            <span class="review-label">제품</span>
                            <span class="review-value">{productName}</span>
                        </div>
                        
                        <!-- 이니셜 -->
                        <div class="review-item slds-m-bottom_small">
                            <span class="review-label">이니셜 문구</span>
                            <span class="review-value">{initials}</span>
                        </div>
                        
                        <!-- 색상 -->
                        <div class="review-item slds-m-bottom_small">
                            <span class="review-label">이니셜 색상</span>
                            <div class="color-preview" style={colorPreviewStyle}></div>
                        </div>
                        
                        <!-- 위치 -->
                        <div class="review-item slds-m-bottom_large">
                            <span class="review-label">이니셜 위치</span>
                            <span class="review-value">{positionLabel}</span>
                        </div>
                    </div>
                    
                    <!-- 픽업 매장 선택 섹션 -->
                    <div class="store-selection">
                        <h3 class="slds-text-heading_small slds-m-bottom_small">픽업 매장 선택</h3>
                        
                        <!-- 매장 선택 버튼 -->
                        <template if:false={hasStoreSelected}>
                            <div class="store-select-button" onclick={openStoreModal}>
                                <div class="store-button-content">
                                    <lightning-icon icon-name="standard:location" size="small"></lightning-icon>
                                    <div class="store-button-text">
                                        <div class="store-button-title">매장 선택</div>
                                        <div class="store-button-subtitle">픽업 가능한 매장 선택</div>
                                    </div>
                                    <lightning-icon icon-name="utility:chevronright" size="small"></lightning-icon>
                                </div>
                            </div>
                        </template>
                        
                        <!-- 선택된 매장 표시 -->
                        <template if:true={hasStoreSelected}>
                            <div class="store-selected" onclick={openStoreModal}>
                                <div class="store-selected-content">
                                    <lightning-icon icon-name="standard:location" size="small"></lightning-icon>
                                    <div class="store-selected-info">
                                        <div class="store-selected-name">{storeName}</div>
                                        <div class="store-selected-status">
                                            <span class="status-dot"></span>
                                            매장 - 픽업 가능
                                        </div>
                                    </div>
                                    <lightning-icon icon-name="utility:chevronright" size="small"></lightning-icon>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                </div>
                
            </div>
            
        </div>
        
        <!-- 매장 선택 모달 -->
        <template if:true={isStoreModalOpen}>
            <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    
                    <!-- 모달 헤더 -->
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" 
                                onclick={closeStoreModal}>
                            <lightning-icon icon-name="utility:close" size="small" alternative-text="Close"></lightning-icon>
                        </button>
                        <h2 class="slds-text-heading_medium">매장 선택하기</h2>
                    </header>
                    
                    <!-- 모달 바디 -->
                    <div class="slds-modal__content slds-p-around_medium">
                        
                        <!-- 매장 목록 -->
                        <div class="store-list">
                            <template if:true={hasStores}>
                                <template for:each={stores} for:item="store">
                                    <div key={store.Id} 
                                         class="store-item"
                                         data-id={store.Id}
                                         onclick={handleStoreClick}>
                                        <div class="store-item-content">
                                            <div class="store-item-info">
                                                <div class="store-item-name">{store.Name}</div>
                                                <div class="store-item-address">{store.Store_Address__c}</div>
                                            </div>
                                            <div class="store-item-status">
                                                <span class="status-dot"></span>
                                                <span class="status-text">매장 - 픽업 가능</span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </template>
                            
                            <!-- 매장 없음 -->
                            <template if:false={hasStores}>
                                <div class="slds-text-align_center slds-p-around_large">
                                    <lightning-icon icon-name="utility:location" size="large"></lightning-icon>
                                    <p class="slds-m-top_small">등록된 매장이 없습니다</p>
                                </div>
                            </template>
                        </div>
                        
                    </div>
                    
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </template>
        
    </lightning-card>
</template>