<apex:page standardController="Opportunity" renderAs="pdf" applyBodyTag="false">
    <head>
        <style>
            @page {
                size: A4;
                margin: 1.5cm;
            }
            
            * {
                box-sizing: border-box;
            }
            
            body {
                font-family: 'Malgun Gothic', 'Dotum', sans-serif;
                font-size: 10pt;
                line-height: 1.4;
            }
            
            .header {
                text-align: center;
                font-size: 22pt;
                font-weight: bold;
                margin-bottom: 25px;
                padding-bottom: 12px;
                border-bottom: 3px solid #000;
            }
            
            .section-title {
                font-size: 12pt;
                font-weight: bold;
                margin: 15px 0 8px 0;
                padding-bottom: 5px;
                border-bottom: 1px solid #666;
            }
            
            .info-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 15px;
                font-size: 9pt;
            }
            
            .info-table td {
                padding: 6px 8px;
                border: 1px solid #999;
            }
            
            .info-table .label {
                background-color: #e8e8e8;
                font-weight: bold;
                width: 20%;
            }
            
            .quotation-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                font-size: 9pt;
            }
            
            .quotation-table th {
                background-color: #333;
                color: white;
                padding: 8px 5px;
                text-align: center;
                font-weight: bold;
            }
            
            .quotation-table td {
                border: 1px solid #999;
                padding: 8px 5px;
                text-align: center;
            }
            
            .total-box {
                text-align: right;
                font-size: 13pt;
                font-weight: bold;
                margin: 15px 0;
                padding: 12px;
                background-color: #f5f5f5;
                border: 2px solid #000;
            }
            
            .image-section {
                margin-top: 20px;
            }
            
            .image-box {
                text-align: center;
                margin: 15px 0;
                page-break-inside: avoid;
            }
            
.image-box img {
    width: 300px !important;
    height: 250px !important;
    object-fit: contain;
    border: 1px solid #ccc;
    padding: 3px;
}
            
            .image-title {
                font-size: 9pt;
                color: #666;
                margin-bottom: 5px;
            }
            
            .notes {
                margin-top: 25px;
                padding-top: 12px;
                border-top: 1px solid #999;
                font-size: 8pt;
                color: #555;
            }
            
            .notes h3 {
                font-size: 10pt;
                margin-bottom: 6px;
                color: #000;
            }
            
            .notes ul {
                margin: 5px 0 5px 15px;
                padding: 0;
            }
            
            .notes li {
                margin-bottom: 3px;
            }
        </style>
    </head>
    
    <body>
        <!-- 헤더 -->
        <div class="header">Quotation</div>
        
        <!-- 기본 정보 -->
        <table class="info-table">
            <tr>
                <td class="label">Quotation Number</td>
                <td>QT-{!Opportunity.Id}</td>
                <td class="label">Date</td>
                <td>
                    <apex:outputText value="{0,date,yyyy MM dd}">
                        <apex:param value="{!TODAY()}" />
                    </apex:outputText>
                </td>
            </tr>
            <tr>
                <td class="label">Customer Name</td>
                <td>{!Opportunity.Account.Name}</td>
                <td class="label">CA</td>
                <td>{!Opportunity.Owner.Name}</td>
            </tr>
            <tr>
                <td class="label">Project Name</td>
                <td colspan="3">{!Opportunity.Name}</td>
            </tr>
        </table>
        
        <!-- 견적 내역 -->
        <div class="section-title">Describtion</div>
        <table class="quotation-table">
            <tr>
                <th style="width: 8%;">No</th>
                <th style="width: 40%;">Product</th>
                <th style="width: 13%;">QTY</th>
                <th style="width: 19%;">Price</th>
                <th style="width: 20%;">Total Amount</th>
            </tr>
            <tr>
                <td>1</td>
                <td style="text-align: left; padding-left: 8px;">{!Opportunity.Name}</td>
                <td>1식</td>
                <td style="text-align: right; padding-right: 8px;">
                    <apex:outputText value="{0, number, ###,###,###}">
                        <apex:param value="{!Opportunity.Total_Amount__c}" />
                    </apex:outputText>원
                </td>
                <td style="text-align: right; padding-right: 8px;">
                    <apex:outputText value="{0, number, ###,###,###}">
                        <apex:param value="{!Opportunity.Total_Amount__c}" />
                    </apex:outputText>원
                </td>
            </tr>
        </table>
        
        <!-- 총액 -->
        <div class="total-box">
            총 견적금액: 
            <apex:outputText value="{0, number, ###,###,###}">
                <apex:param value="{!Opportunity.Total_Amount__c}" />
            </apex:outputText>원
        </div>
        
        <!-- 디자인 시안 (별도 페이지) -->
        <div style="page-break-before: always;">
            <div class="section-title">디자인 시안</div>
            
            <div class="image-section">
                <apex:repeat value="{!Opportunity.ContentDocumentLinks}" var="cdl">
                    <div class="image-box">
                        <div class="image-title">{!cdl.ContentDocument.Title}</div>
                        <img src="/sfc/servlet.shepherd/version/download/{!cdl.ContentDocument.LatestPublishedVersionId}" />
                    </div>
                </apex:repeat>
            </div>
        </div>
        
        <!-- 안내사항 -->
        <div class="notes">
            <h3>※ 안내사항</h3>
            <ul>
                <li>본 견적서는 발행일로부터 30일간 유효합니다.</li>
                <li>최종 제품은 시안과 다소 차이가 있을 수 있습니다.</li>
                <li>제작 기간은 최종 디자인 확정 후 2-3주 소요됩니다.</li>
                <li>문의사항은 담당자에게 연락주시기 바랍니다.</li>
            </ul>
            
            <div style="margin-top: 12px; text-align: center;">
                <apex:outputPanel rendered="{!NOT(ISBLANK(Opportunity.Owner.Phone))}">
                    담당자 연락처: {!Opportunity.Owner.Phone} / 
                </apex:outputPanel>
                이메일: {!Opportunity.Owner.Email}
            </div>
        </div>
    </body>
</apex:page>